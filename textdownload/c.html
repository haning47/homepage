<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>網址檔案下載工具 (下載到本機)</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        input[type="text"] { width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        #message { margin-top: 15px; color: red; }
    </style>
</head>
<body>

    <div class="container">
        <h1>檔案下載工具 (下載到本機)</h1>
        <p>請注意：此工具是將檔案下載到您<strong>本機電腦</strong>的瀏覽器下載資料夾，無法直接上傳到雲端硬碟。</p>

        <label for="urlInput">檔案網址：</label>
        <input type="text" id="urlInput" placeholder="請輸入檔案的直接下載網址，例如：https://example.com/file.pdf">

        <label for="filenameInput">檔名（超連結文字）：</label>
        <input type="text" id="filenameInput" placeholder="請輸入您想要的檔名，不含副檔名，例如：我的文件">

        <button onclick="downloadFile()">下載檔案</button>

        <div id="message"></div>
    </div>

    <script>
        function downloadFile() {
            const fileUrl = document.getElementById('urlInput').value.trim();
            let baseFilename = document.getElementById('filenameInput').value.trim();
            const messageElement = document.getElementById('message');
            messageElement.textContent = '';

            if (!fileUrl) {
                messageElement.textContent = '錯誤：請輸入檔案網址。';
                return;
            }

            if (!baseFilename) {
                baseFilename = 'downloaded_file'; // 如果沒有輸入，給一個預設檔名
            }

            try {
                // 1. 取得副檔名
                // 找到網址中最後一個點號(.)之後的部分作為副檔名
                const urlParts = fileUrl.split('.');
                const extension = urlParts.length > 1 ? '.' + urlParts.pop().split('?')[0].split('#')[0] : '';

                // 2. 組合最終檔名
                const finalFilename = baseFilename + extension;

                // 3. 創建一個隱藏的 a 標籤來觸發下載
                const a = document.createElement('a');
                a.href = fileUrl;
                a.download = finalFilename; // 設定下載的檔名
                document.body.appendChild(a);
                a.click(); // 模擬點擊下載
                document.body.removeChild(a);

                messageElement.textContent = `嘗試下載檔案： ${finalFilename} ... 請檢查您的下載資料夾。`;
                messageElement.style.color = 'green';

            } catch (e) {
                messageElement.textContent = '下載失敗：請檢查網址是否正確，或檔案是否存在跨域問題。';
                messageElement.style.color = 'red';
                console.error(e);
            }
        }
    </script>

</body>
</html>